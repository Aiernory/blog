<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ren.aiernory.blog.mapper.PublishMapper">
    
    <resultMap id="publishWithAuthor" type="ren.aiernory.blog.model.Publish">
        <id column="id" property="id"/>
        <result property="title" column="title"/>
        <result property="descriptionCode" column="description_code"/>
        <result property="descriptionDoc" column="description_doc"/>
        <result property="gmtCreate" column="gmt_create"/>
        <result property="gmtModified" column="gmt_modified"/>
        <result property="creator" column="creator"/>
        <result property="viewCount" column="view_count"/>
        <result property="likeCount" column="like_count"/>
        <result property="commentCount" column="comment_count"/>
        <result property="musicStatus" column="music_status"/>
        <result property="musicContent" column="music_content"/>
        <association property="author" javaType="ren.aiernory.blog.model.User" fetchType="lazy">
            <id property="id" column="creator" />
            <result property="name" column="name"/>
            <result property="accountId" column="account_id"/>
            <result property="token" column="token"/>
            <result property="gmtCreate" column="gmt_create"/>
            <result property="gmtModified" column="gmt_modified"/>
            <result property="bio" column="bio"/>
            <result property="avatarUrl" column="avatar_url"/>
        </association>
    </resultMap>
    
    
    <!--全部，不分页，没实际用上-->
    <select id="listAllWithUser" resultMap="publishWithAuthor">
        select p.*,u.*
        from publish AS p,user AS u
        where u.id=p.creator
    </select>
    <!--全部文章分页-->
    <select id="listAllWithUserByPage" resultMap="publishWithAuthor" >
        select p.*,u.*
        from publish AS p,user AS u
        where u.id=p.creator
        limit #{page},#{size}
    </select>
    <!--总数-->
    <select id="getTotalCount" resultType="Integer">
        select count(1)
        from publish
    </select>
    <!--用户文章分页-->
    <select id="listByCreatorWithUserByPage" resultMap="publishWithAuthor">
        select p.*,u.*
        from publish AS p,user AS u
        where u.id=#{user.id} and u.id=p.creator
        limit #{page},#{size}
    </select>
    <!--用户的文章数-->
    <select id="getTotalCountByCreator" resultType="Integer">
        select count(1)
        from publish
        where creator=#{user.id}
    </select>
    
    <!--结果带上user-->
    <select id="selectById" resultType="Integer" resultMap="publishWithAuthor">
        select *
        from publish
        where id=#{id}
    </select>
</mapper>